<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannabis Map - State Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        .status-fully-legal { color: #6B8E6B; font-weight: bold; }
        .status-medical-only { color: #7FA7C4; font-weight: bold; }
        .status-decriminalized { color: #D4A574; font-weight: bold; }
        .status-illegal { color: #B85C52; font-weight: bold; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .warning { background-color: #fff3cd; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Cannabis Legality Map - State Verification Test</h1>

    <div class="test-section">
        <h2>Test Results</h2>
        <button onclick="runTests()">Run All Tests</button>
        <button onclick="testStateById()">Test State by ID</button>
        <div id="results"></div>
    </div>

    <script>
        // Expected state counts by status (includes territories)
        const expectedCounts = {
            'fully-legal': 24,
            'medical-only': 14,  // Includes Kentucky + Puerto Rico + Guam
            'decriminalized': 2,
            'illegal': 12
        };

        // All 50 US states
        const allStates = [
            'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado',
            'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho',
            'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
            'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi',
            'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey',
            'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma',
            'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota',
            'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington',
            'West Virginia', 'Wisconsin', 'Wyoming'
        ];

        // State ID to Name mapping (FIPS codes)
        const stateIdToName = {
            1: 'Alabama', 2: 'Alaska', 4: 'Arizona', 5: 'Arkansas',
            6: 'California', 8: 'Colorado', 9: 'Connecticut', 10: 'Delaware',
            12: 'Florida', 13: 'Georgia', 15: 'Hawaii', 16: 'Idaho',
            17: 'Illinois', 18: 'Indiana', 19: 'Iowa', 20: 'Kansas',
            21: 'Kentucky', 22: 'Louisiana', 23: 'Maine', 24: 'Maryland',
            25: 'Massachusetts', 26: 'Michigan', 27: 'Minnesota', 28: 'Mississippi',
            29: 'Missouri', 30: 'Montana', 31: 'Nebraska', 32: 'Nevada',
            33: 'New Hampshire', 34: 'New Jersey', 35: 'New Mexico', 36: 'New York',
            37: 'North Carolina', 38: 'North Dakota', 39: 'Ohio', 40: 'Oklahoma',
            41: 'Oregon', 42: 'Pennsylvania', 44: 'Rhode Island', 45: 'South Carolina',
            46: 'South Dakota', 47: 'Tennessee', 48: 'Texas', 49: 'Utah',
            50: 'Vermont', 51: 'Virginia', 53: 'Washington', 54: 'West Virginia',
            55: 'Wisconsin', 56: 'Wyoming'
        };

        function runTests() {
            const results = document.getElementById('results');
            let html = '<h3>Running Comprehensive Tests...</h3>';

            // Test 1: Load the state data
            fetch('index.js')
                .then(response => response.text())
                .then(jsContent => {
                    // Extract stateData object
                    const stateDataMatch = jsContent.match(/const stateData = ({[\s\S]*?^};)/m);
                    if (!stateDataMatch) {
                        html += '<p class="error">❌ Failed to extract stateData from index.js</p>';
                        results.innerHTML = html;
                        return;
                    }

                    // Parse the state data
                    const stateDataStr = stateDataMatch[1];
                    const stateData = eval('(' + stateDataStr + ')');

                    // Test 1: Check if all 50 states are present
                    html += '<h4>Test 1: All States Present</h4>';
                    const missingStates = allStates.filter(state => !stateData[state]);
                    const extraStates = Object.keys(stateData).filter(state => !allStates.includes(state));

                    if (missingStates.length === 0 && extraStates.length === 0) {
                        html += '<p class="success">✅ All 50 states present</p>';
                    } else {
                        if (missingStates.length > 0) {
                            html += `<p class="error">❌ Missing states: ${missingStates.join(', ')}</p>`;
                        }
                        if (extraStates.length > 0) {
                            html += `<p class="warning">⚠️ Extra states: ${extraStates.join(', ')}</p>`;
                        }
                    }

                    // Test 2: Count states by status
                    html += '<h4>Test 2: State Status Distribution</h4>';
                    const statusCounts = {
                        'fully-legal': 0,
                        'medical-only': 0,
                        'decriminalized': 0,
                        'illegal': 0
                    };

                    Object.values(stateData).forEach(state => {
                        if (statusCounts.hasOwnProperty(state.status)) {
                            statusCounts[state.status]++;
                        }
                    });

                    html += '<table>';
                    html += '<tr><th>Status</th><th>Count</th><th>Expected</th><th>Match</th></tr>';
                    for (const [status, count] of Object.entries(statusCounts)) {
                        const expected = expectedCounts[status];
                        const match = count === expected ? '✅' : '❌';
                        const rowClass = count === expected ? 'success' : 'error';
                        html += `<tr class="${rowClass}"><td class="status-${status}">${status}</td><td>${count}</td><td>${expected}</td><td>${match}</td></tr>`;
                    }
                    html += '</table>';

                    // Test 3: List all states by category
                    html += '<h4>Test 3: States by Category</h4>';

                    for (const [status, _] of Object.entries(statusCounts)) {
                        const statesInCategory = Object.entries(stateData)
                            .filter(([_, data]) => data.status === status)
                            .map(([name, _]) => name)
                            .sort();

                        html += `<p><strong class="status-${status}">${status.toUpperCase()} (${statesInCategory.length}):</strong><br>`;
                        html += statesInCategory.join(', ');
                        html += '</p>';
                    }

                    // Test 4: Check Kentucky specifically
                    html += '<h4>Test 4: Kentucky Status Update</h4>';
                    if (stateData['Kentucky']) {
                        const kyStatus = stateData['Kentucky'].status;
                        if (kyStatus === 'medical-only') {
                            html += '<p class="success">✅ Kentucky correctly updated to medical-only</p>';
                            html += `<p>Notes: ${stateData['Kentucky'].cannabis.notes}</p>`;
                        } else {
                            html += `<p class="error">❌ Kentucky status is "${kyStatus}" - should be "medical-only"</p>`;
                        }
                    }

                    // Test 5: Check Alabama specifically
                    html += '<h4>Test 5: Alabama Status</h4>';
                    if (stateData['Alabama']) {
                        const alStatus = stateData['Alabama'].status;
                        if (alStatus === 'illegal') {
                            html += '<p class="success">✅ Alabama correctly listed as illegal (program not yet operational)</p>';
                            html += `<p>Notes: ${stateData['Alabama'].cannabis.notes}</p>`;
                        } else {
                            html += `<p class="warning">⚠️ Alabama status is "${alStatus}" - verify if program is now operational</p>`;
                        }
                    }

                    // Test 6: Check data structure completeness
                    html += '<h4>Test 6: Data Structure Completeness</h4>';
                    let incompleteStates = [];
                    for (const [stateName, data] of Object.entries(stateData)) {
                        if (!data.status || !data.cannabis || !data.psilocybin || !data.dmt || !data.peyote) {
                            incompleteStates.push(stateName);
                        }
                    }

                    if (incompleteStates.length === 0) {
                        html += '<p class="success">✅ All states have complete data structures</p>';
                    } else {
                        html += `<p class="error">❌ Incomplete data for: ${incompleteStates.join(', ')}</p>`;
                    }

                    results.innerHTML = html;
                })
                .catch(error => {
                    results.innerHTML = `<p class="error">❌ Error loading state data: ${error.message}</p>`;
                });
        }

        function testStateById() {
            const stateId = prompt('Enter state FIPS code (1-56):');
            if (stateId && stateIdToName[parseInt(stateId)]) {
                alert(`State ID ${stateId} maps to: ${stateIdToName[parseInt(stateId)]}`);
            } else {
                alert(`Invalid state ID: ${stateId}`);
            }
        }

        // Auto-run tests on load
        window.onload = () => {
            document.getElementById('results').innerHTML = '<p>Click "Run All Tests" to verify the map data.</p>';
        };
    </script>
</body>
</html>
